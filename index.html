<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Survey Card</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .star-rating {
            display: flex;
            gap: 4px;
        }
        
        .star {
            font-size: 24px;
            color: #d1d5db;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .star:hover,
        .star.active {
            color: #fbbf24;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success-checkmark {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #10b981;
            position: relative;
            margin: 0 auto 20px;
        }
        
        .success-checkmark::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 30px;
            font-weight: bold;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-gradient-to-br from-blue-50 to-indigo-100 p-6 font-sans">
  <main class="max-w-2xl mx-auto">
   <div id="survey-card" class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100"><!-- Survey Header -->
    <div class="text-center mb-8">
     <h1 id="survey-title" class="text-3xl font-bold text-gray-800 mb-3">Customer Feedback Survey</h1>
     <p id="survey-description" class="text-gray-600 text-lg">Help us improve our service by sharing your experience</p>
    </div><!-- Survey Form -->
    <form id="survey-form" class="space-y-6"><!-- Name Field -->
     <div><label for="name" class="block text-sm font-semibold text-gray-700 mb-2">Your Name</label> <input type="text" id="name" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="Enter your full name">
     </div><!-- Email Field -->
     <div><label for="email" class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label> <input type="email" id="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="your.email@example.com">
     </div><!-- Rating Field -->
     <div><label class="block text-sm font-semibold text-gray-700 mb-3">Overall Rating</label>
      <div class="star-rating" id="star-rating"><span class="star" data-rating="1">★</span> <span class="star" data-rating="2">★</span> <span class="star" data-rating="3">★</span> <span class="star" data-rating="4">★</span> <span class="star" data-rating="5">★</span>
      </div><input type="hidden" id="rating" name="rating" required>
      <p class="text-sm text-gray-500 mt-2">Click to rate from 1 to 5 stars</p>
     </div><!-- Feedback Field -->
     <div><label for="feedback" class="block text-sm font-semibold text-gray-700 mb-2">Your Feedback</label> <textarea id="feedback" name="feedback" rows="4" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none" placeholder="Please share your thoughts and suggestions..."></textarea>
     </div><!-- Recommendation Field -->
     <div><label class="block text-sm font-semibold text-gray-700 mb-3">Would you recommend us to others?</label>
      <div class="flex gap-4"><label class="flex items-center cursor-pointer"> <input type="radio" name="recommend" value="yes" required class="mr-2 text-blue-600"> <span class="text-gray-700">Yes, definitely</span> </label> <label class="flex items-center cursor-pointer"> <input type="radio" name="recommend" value="maybe" required class="mr-2 text-blue-600"> <span class="text-gray-700">Maybe</span> </label> <label class="flex items-center cursor-pointer"> <input type="radio" name="recommend" value="no" required class="mr-2 text-blue-600"> <span class="text-gray-700">No</span> </label>
      </div>
     </div><!-- Submit Button -->
     <div class="pt-4"><button type="submit" id="submit-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 focus:ring-4 focus:ring-blue-200"> <span id="submit-button-text">Submit Survey</span> <span id="loading-spinner" class="hidden ml-2">
        <svg class="animate-spin h-5 w-5 inline" viewbox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle> <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg></span> </button>
     </div>
    </form><!-- Success Message -->
    <div id="success-message" class="hidden text-center fade-in">
     <div class="success-checkmark"></div>
     <h2 class="text-2xl font-bold text-gray-800 mb-3">Thank You!</h2>
     <p class="text-gray-600 mb-6">Your feedback has been submitted successfully. We appreciate your time and input!</p><button id="submit-another" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200"> Submit Another Survey </button>
    </div>
   </div><!-- Response Counter -->
   <div class="text-center mt-6">
    <p class="text-gray-600"><span id="response-count">0</span> responses collected</p>
   </div>
  </main>
  <script>
        // Configuration object
        const defaultConfig = {
            survey_title: "Customer Feedback Survey",
            survey_description: "Help us improve our service by sharing your experience",
            submit_button_text: "Submit Survey",
            background_color: "#dbeafe",
            card_color: "#ffffff",
            primary_color: "#2563eb",
            text_color: "#1f2937",
            accent_color: "#10b981"
        };

        let currentRating = 0;
        let responseCount = 0;

        // Data SDK handler
        const dataHandler = {
            onDataChanged(data) {
                responseCount = data.length;
                document.getElementById('response-count').textContent = responseCount;
            }
        };

        // Star rating functionality
        function initializeStarRating() {
            const stars = document.querySelectorAll('.star');
            
            stars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    currentRating = index + 1;
                    document.getElementById('rating').value = currentRating;
                    updateStarDisplay();
                });
                
                star.addEventListener('mouseenter', () => {
                    highlightStars(index + 1);
                });
            });
            
            document.getElementById('star-rating').addEventListener('mouseleave', () => {
                updateStarDisplay();
            });
        }

        function highlightStars(rating) {
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                star.classList.toggle('active', index < rating);
            });
        }

        function updateStarDisplay() {
            highlightStars(currentRating);
        }

        // Form submission
        async function handleSubmit(event) {
            event.preventDefault();
            
            if (responseCount >= 999) {
                showInlineMessage("Maximum limit of 999 responses reached. Thank you for your interest!", "error");
                return;
            }
            
            if (currentRating === 0) {
                showInlineMessage("Please select a rating before submitting.", "error");
                return;
            }
            
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-button-text');
            const loadingSpinner = document.getElementById('loading-spinner');
            
            // Show loading state
            submitBtn.disabled = true;
            submitText.textContent = 'Submitting...';
            loadingSpinner.classList.remove('hidden');
            
            const formData = new FormData(event.target);
            const surveyData = {
                id: Date.now().toString(),
                name: formData.get('name'),
                email: formData.get('email'),
                rating: currentRating,
                feedback: formData.get('feedback'),
                recommend: formData.get('recommend'),
                submitted_at: new Date().toISOString()
            };
            
            try {
                const result = await window.dataSdk.create(surveyData);
                
                if (result.isOk) {
                    showSuccessMessage();
                } else {
                    showInlineMessage("Failed to submit survey. Please try again.", "error");
                }
            } catch (error) {
                showInlineMessage("An error occurred. Please try again.", "error");
            } finally {
                // Reset loading state
                submitBtn.disabled = false;
                submitText.textContent = document.getElementById('submit-button-text').textContent;
                loadingSpinner.classList.add('hidden');
            }
        }

        function showSuccessMessage() {
            document.getElementById('survey-form').classList.add('hidden');
            document.getElementById('success-message').classList.remove('hidden');
        }

        function resetForm() {
            document.getElementById('survey-form').classList.remove('hidden');
            document.getElementById('success-message').classList.add('hidden');
            document.getElementById('survey-form').reset();
            currentRating = 0;
            updateStarDisplay();
            document.getElementById('rating').value = '';
        }

        function showInlineMessage(message, type) {
            const existingMessage = document.querySelector('.inline-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `inline-message p-4 rounded-lg mb-4 ${type === 'error' ? 'bg-red-100 text-red-700 border border-red-200' : 'bg-green-100 text-green-700 border border-green-200'}`;
            messageDiv.textContent = message;
            
            const form = document.getElementById('survey-form');
            form.insertBefore(messageDiv, form.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Element SDK implementation
        async function onConfigChange(config) {
            const titleElement = document.getElementById('survey-title');
            const descriptionElement = document.getElementById('survey-description');
            const submitButtonTextElement = document.getElementById('submit-button-text');
            const body = document.body;
            const card = document.getElementById('survey-card');
            const submitBtn = document.getElementById('submit-btn');
            
            if (titleElement) {
                titleElement.textContent = config.survey_title || defaultConfig.survey_title;
            }
            if (descriptionElement) {
                descriptionElement.textContent = config.survey_description || defaultConfig.survey_description;
            }
            if (submitButtonTextElement) {
                submitButtonTextElement.textContent = config.submit_button_text || defaultConfig.submit_button_text;
            }
            
            // Apply colors
            const backgroundColor = config.background_color || defaultConfig.background_color;
            const cardColor = config.card_color || defaultConfig.card_color;
            const primaryColor = config.primary_color || defaultConfig.primary_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const accentColor = config.accent_color || defaultConfig.accent_color;
            
            body.style.background = `linear-gradient(to bottom right, ${backgroundColor}, ${primaryColor}20)`;
            card.style.backgroundColor = cardColor;
            card.style.color = textColor;
            submitBtn.style.backgroundColor = primaryColor;
            
            // Update text colors
            const headings = document.querySelectorAll('h1, h2');
            headings.forEach(heading => {
                heading.style.color = textColor;
            });
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.card_color || defaultConfig.card_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ card_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.primary_color || defaultConfig.primary_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.accent_color || defaultConfig.accent_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ accent_color: value });
                            }
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["survey_title", config.survey_title || defaultConfig.survey_title],
                ["survey_description", config.survey_description || defaultConfig.survey_description],
                ["submit_button_text", config.submit_button_text || defaultConfig.submit_button_text]
            ]);
        }

        // Initialize everything
        async function initialize() {
            // Initialize Data SDK
            if (window.dataSdk) {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    console.error("Failed to initialize data SDK");
                }
            }
            
            // Initialize Element SDK
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }
            
            // Initialize star rating
            initializeStarRating();
            
            // Add event listeners
            document.getElementById('survey-form').addEventListener('submit', handleSubmit);
            document.getElementById('submit-another').addEventListener('click', resetForm);
        }

        // Start the application
        initialize();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'998d5f7b426b7e79',t:'MTc2MjE4ODY1MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>